---
title: "Analysis of Volunteer Routines (Motif Sets) in Gravity Spy"
author: ""
date: "`r Sys.time()`"
output:
  html_document:
    fig_caption: yes
    highlight: pygments
    number_sections: yes
    theme: spacelab
    toc: yes
    toc_float:
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '5'
  bookdown::html_document2: default
  bookdown::pdf_document2: default
always_allow_html: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# load packages and data
library(readr)
library(dplyr)
library(DT)
library(tidytext)
library(forcats)
library(ggplot2)
library(kableExtra)


# Set objects 
experts <- c("uber_pye","areeda","mzevin1","RF45","jrsmith02","sbc538")
collaborators <- c("adamamiller","olipatane","smarttiz","jafeldt","mcoughlin","citizenscientist1994","cjackso3",
                   "camallen","lmp579","sciencejedi","crowston","Carsten","jessiemcd","ejm553","srallen",
                   "costerlu@syr.edu","lcalian","joeykey","matsoulina","trouille","zooniverse")
moderators <- c("achilles308","futurewaves","wavewavewave","EcceruElme")

# Data on research drive folder /Volumes/cbjackson2/motif. Remeber to connect to VPN and mount drive

user_motifs <- read_csv("/Volumes/cbjackson2/motif/user_level_motif.csv")
user_motifs <- user_motifs[which(!user_motifs$type %in% c("otheruser","superuser") ),]
user_motifs$type <- recode(user_motifs$type, promoted = "promoted", detractor = "notpromoted",.default = NA_character_)
user_motifs$user_id <- as.factor(user_motifs$user_id)

########################  Add classification accuracy and total activities
user_performance <- read_csv("/Volumes/cbjackson2/motif/user_performance.csv")
user_performance[,c(1,9:10)] <- NULL
names(user_performance)[c(1,3,4)] <- c("user_id","start_session","end_session")
user_performance$user_id <- as.factor(user_performance$user_id)
setwd("~/Desktop/GitHub Code/motifs")

########################  Add promotion

```

# Research question

- What modes of action define participation in Gravity Spy?    
    - Quantitative description of common motifs in Gravity Spy. Which motifs are most popular as (1) executed by many volunteers, (2) appearing most often in the data, and (3) set diversity.  

- What modes of action distinguish promoted contributors and those who remain at the same level?   
    - Quantitative analysis of motifs using tf-idf by level. Some comparison of successful motifs at levels. Are there similar activities in each set. For example, is exploring a necessary activity in promoted motifs   
    - Promoted as a representation of learning this Sorenson’s FOP would still apply. Using trace ethnography, we could pull 
    examples of promoted motifs and discuss them in the context of FOP. 


- What is the relationship between activities and performance?     

- Do volunteers maintain certain routines?    
    - Determine whether some volunteers are engaged in routine modes of action that lead to successful or non-successful promotion. Rely on Sorenson to provide added context and triangulate findings from the CSCW paper with results. E.g., Does successful promotion rely on motifs in which authoritative engagements are dominant in L2 & L3 and shift to agent-centered and communal in L4? Do people who don’t have these motifs drop out?

# Methods
Motifs were built in chunks of five such that we would capture overlapping activities in motifs. 

To reduce the number of motifs, we combined the number similar activities into a single motif such that five learning activities in a pattern of interactions would be represented as l5 and 12 learning interactions would be represented as l12. 

![Caption for the picture.](motif-setup.png){ width=100% }
For motifs, we used descriptive statistics to understand common and uncommon modes of action (motif), and whether a motif was rare as measured by term frequency inverse document frequency (tfidf)   

__term frequency (tf)__ - how frequently a word occurs in a document. __inverse document frequency (idf)__ which decreases the weight for commonly used words and increases the weight for words that are not used very much in a collection of documents. __tf-idf__ (the two quantities multiplied together) indicated the frequency of a term adjusted for how rarely it is used.    

To follow the analogy - a document is one of the grouping factors (e.g. level, user, promoted/not promted) and a term is a motif. In this analysis, we are only concerned with the series of activities in the set of five and not the order of those activities. 

# Results


## User motifs
```{r, echo=FALSE,include=FALSE}
# What modes of action. How many different motifs are present for a volunteer
user_summary_sets <- user_motifs %>% 
  group_by(user_id) %>%  
  summarize(
    distinct_set = length(unique(set1)),
    total_sets = length(set1),
    sessions = length(unique(start_time)),
    set_diversiy = (total_sets/distinct_set),
    first_set = min(start_time),
    last_set = max(start_time), 
    current_level = max(as.numeric(level)))%>% 
  mutate(tenure_time =  difftime(last_set,first_set,units = "mins"),
        status = if_else(last_set > as.Date(max(user_motifs$start_time)) %m-% months(1),"current","dropout"))

user_summary_sets_viz <- ggplot(subset(user_summary_sets,distinct_set>2), aes(x=total_sets, y=distinct_set)) +
  geom_point() + 
  labs(x = expression(~log~(Sets)), y = "Distinct Sets") + 
  theme_minimal()+ scale_x_continuous(trans='log2') +
  scale_y_continuous(trans='log2')


### ALL MOTIFS
user_level_sets <- user_motifs %>% 
  group_by(user_id,level) %>%  
  summarize(
    distinct_set = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_set,
    sessions = length(unique(start_time)),
    first_lset = min(start_time),
    last_lset = max(start_time),
    status = paste0(unique(type))
  ) %>%  
  mutate(level_time =  difftime(last_lset,first_lset,units = "mins"),
         status = if_else(level=="4","current",paste0(status)))

# Does routine diversity lead to increased chances of promotion

# Do volunteers with similar routines perform the same

# Are some motif sets associated with greater likelihood of promotion





##### LEVEL 1 MOTIFS ##### 
library(data.table)
l1user_sets <-  data.table(user_level_sets[which(user_level_sets$level==1),])
l1user_sets <- l1user_sets %>%  select(user_id, level, distinct_set, total_sets) %>%
 mutate(
    distinct_sets.s = scale(distinct_set),
    total_sets.s = scale(total_sets),
    sets_diversity.s = scale(total_sets),
    sets_diversity.s2 = total_sets.s*distinct_sets.s,
    average.z = (distinct_sets.s + (total_sets.s)) / 2
)


### ALL MOTIFS BY TYPE
user_level_type_sets <- user_motifs %>% 
  group_by(user_id,level,type) %>%  
  summarize(
    distinct_sets = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_sets
  )

library(data.table)
l1usertype_sets <-  data.table(user_level_type_sets[which(user_level_type_sets$level==1),])
l1usertype_sets <- l1usertype_sets %>%  select(user_id, level, distinct_sets, total_sets, type) %>%
 mutate(
    distinct_sets.s = scale(distinct_sets),
    total_sets.s = scale(total_sets),
    sets_diversity.s = scale(total_sets),
    sets_diversity.s2 = total_sets.s*distinct_sets.s,
    average.z = (distinct_sets.s + (total_sets.s)) / 2
)


### ALL MOTIFS BY USER in L1
allL1sets <- user_motifs[which(user_motifs$level==1),]

allL1_summary <- allL1sets %>% 
  group_by(user_id,type) %>%  
  summarize(
    start_level = min(start_time),
    distinct_sets = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_sets
  )

allL1_sets_type_summary <- allL1sets %>% 
  group_by(user_id,set1,type) %>%  
  summarize(
    total_sets = length(set1)
  )

allL1_set_summary <- allL1sets %>% 
  group_by(user_id,set1,type) %>%  
  summarize(
    first_l1set = min(start_time),
    last_l1set = max(start_time),
    distinct_motif_combinations = length(unique(motif)),
    total_motif = length(motif)
  )

# `r round( ,digits=2)` ($\sigma$ = `r round( ,digits=2)`, $\bar{x}$ = `r round( ,digits=2)`) 
```

Our dataset contains the motifs of `r length(unique(user_summary_sets$user_id))` users. There were `r table(user_summary_sets$status)`
users who made contributions in the month before data collection ended which means that of the users in our dataset, only `r round(table(user_summary_sets$status)[1]/dim(user_summary_sets)[1],digits=2)*100`% were active in the project. 

Based on our arrangement of motifs, the average number of distinct motif sets was `r round(mean(user_summary_sets$distinct_set),digits=2)` ($\sigma$ = `r round(sd(user_summary_sets$distinct_set),digits=2)`, $\bar{x}$ = `r  round(median(user_summary_sets$distinct_set), digits=2)`) and on average `r round(mean(user_summary_sets$total_sets),digits=2)`  ($\sigma$ = `r round(sd(user_summary_sets$total_sets),digits=2)`, $\bar{x}$ = `r  round(median(user_summary_sets$total_sets), digits=2)`). A scatter plot displaying the x is included in \@ref(fig:setsfig)) 

```{r setsfig, fig.cap="A scatter plot showing the log.", echo=FALSE}
user_summary_sets_viz
```



