---
title: "Analysis of Volunteer Motifs (Sets) in Gravity Spy"
author: "Corey Jackson"
date: "`r Sys.time()`"
output:
  html_document:
    fig_caption: yes
    highlight: pygments
    number_sections: yes
    theme: spacelab
    toc: yes
    toc_float:
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '5'
always_allow_html: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# load packages and data
library(readr)
library(dplyr)
library(DT)
library(tidytext)
library(forcats)
library(ggplot2)
library(kableExtra)


# Set objects 
experts <- c("uber_pye","areeda","mzevin1","RF45","jrsmith02","sbc538")
collaborators <- c("adamamiller","olipatane","smarttiz","jafeldt","mcoughlin","citizenscientist1994","cjackso3",
                   "camallen","lmp579","sciencejedi","crowston","Carsten","jessiemcd","ejm553","srallen",
                   "costerlu@syr.edu","lcalian","joeykey","matsoulina","trouille","zooniverse")
moderators <- c("achilles308","futurewaves","wavewavewave","EcceruElme")

user_motifs <- read_csv("~/Box/Research/Trajectory (Motifs)/user_level_motif.csv")
user_motifs <- user_motifs[which(!user_motifs$type %in% c("otheruser","superuser") ),]
user_motifs$type <- recode(user_motifs$type, promoted = "promoted", detractor = "notpromoted",.default = NA_character_)
user_motifs$user_id <- as.factor(user_motifs$user_id)

########################  Add classification accuracy and total activities
user_performance <- read_csv("~/Box/Research/Trajectory (Motifs)/user_performance.csv")
user_performance[,c(1,9:10)] <- NULL
names(user_performance)[c(1,3,4)] <- c("user_id","start_session","end_session")
user_performance$user_id <- as.factor(user_performance$user_id)
```

## Research question

- What modes of action define participation in Gravity Spy?    
    - Quantitative description of common motifs in Gravity Spy. Which motifs are most popular as (1) conducted by many volunteers,
    (2) appearing most often in the data, and (3) set diversity.  

- What modes of action distinguish promoted contributors and those who remain at the same level?   
    - Quantitative analysis of motifs using tf-idf by level. Some comparison of successful motifs at levels. Are there similar 
    activities in each set. For example, is exploring a necessary activity in promoted motifs   
    - Promoted as a representation of learning this Sorenson’s FOP would still apply. Using trace ethnography, we could pull 
    examples of promoted motifs and discuss them in the context of FOP. 


- What is the relationship between activities and performance?     

- Do volunteers maintain certain routines?    
    - Determine whether some volunteers are engaged in routine modes of action that lead to successful or non-successful   
    promotion. Rely on Sorenson to provide added context and triangulate findings from the CSCW paper with results. E.g., Does 
    successful promotion rely on motifs in which authoritative engagements are dominant in L2 & L3 and shift to agent-centered 
    and communal in L4? Do people who don’t have these motifs drop out?


## Methods

## Results

```{r}
# What modes of action. How many different motifs are present for a volunteer
user_summary_sets <- user_motifs %>% 
  group_by(user_id) %>%  
  summarize(
    distinct_set = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_set
  )

### ALL MOTIFS
user_level_sets <- user_motifs %>% 
  group_by(user_id,level) %>%  
  summarize(
    distinct_set = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_set,
    sessions = length(unique(start_time))

  )

##### LEVEL 1 MOTIFS ##### 
library(data.table)
l1user_sets <-  data.table(user_level_sets[which(user_level_sets$level==1),])
l1user_sets <- l1user_sets %>%  select(user_id, level, distinct_set, total_sets) %>%
 mutate(
    distinct_sets.s = scale(distinct_set),
    total_sets.s = scale(total_sets),
    sets_diversity.s = scale(total_sets),
    sets_diversity.s2 = total_sets.s*distinct_sets.s,
    average.z = (distinct_sets.s + (total_sets.s)) / 2
)


### ALL MOTIFS BY TYPE
user_level_type_sets <- user_motifs %>% 
  group_by(user_id,level,type) %>%  
  summarize(
    distinct_sets = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_sets
  )

library(data.table)
l1usertype_sets <-  data.table(user_level_type_sets[which(user_level_type_sets$level==1),])
l1usertype_sets <- l1usertype_sets %>%  select(user_id, level, distinct_sets, total_sets, type) %>%
 mutate(
    distinct_sets.s = scale(distinct_sets),
    total_sets.s = scale(total_sets),
    sets_diversity.s = scale(total_sets),
    sets_diversity.s2 = total_sets.s*distinct_sets.s,
    average.z = (distinct_sets.s + (total_sets.s)) / 2
)


### ALL MOTIFS BY USER in L1
allL1sets <- user_motifs[which(user_motifs$level==1),]

allL1_summary <- allL1sets %>% 
  group_by(user_id,type) %>%  
  summarize(
    start_level = min(start_time),
    distinct_sets = length(unique(set1)),
    total_sets = length(set1),
    set_diversiy = total_sets/distinct_sets
  )

allL1_sets_type_summary <- allL1sets %>% 
  group_by(user_id,set1,type) %>%  
  summarize(
    total_sets = length(set1)
  )

allL1_set_summary <- allL1sets %>% 
  group_by(user_id,set1,type) %>%  
  summarize(
    first_l1set = min(start_time),
    last_l1set = max(start_time),
    distinct_motif_combinations = length(unique(motif)),
    total_motif = length(motif)
  )

allL1_set_summary$level_time <- difftime(allL1_set_summary$last_l1set,allL1_set_summary$first_l1set,units = "days")
```

### Workflow 1



#### Common modes of action at the volunteer/workflow level

#### Promoted vs. non-promoted activities




